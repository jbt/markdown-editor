(function(){function q(m){function r(a,d,b,c){return a.slice(0,d)+(c||"")+a.slice(d+(+b||0))}function p(a){this.g=a}function t(a,d){if(!a)return null;var b=0,c=a;do{var e=c;if(c=c.firstChild){do{var f=c.textContent.length;if(b<=d&&b+f>d)break;b+=f}while(c=c.nextSibling)}if(!c)break}while(c&&c.hasChildNodes()&&3!=c.nodeType);if(c)return{element:c,offset:d-b};if(e){for(c=e;c&&c.lastChild;)c=c.lastChild;return 3===c.nodeType?{element:c,offset:c.textContent.length}:{element:c,offset:0}}return{element:a,offset:0,
error:!0}}function k(a){this.l=a;this.f=[];this.m=[]}function h(a,d){if(!(this instanceof h))return new h(a,d);d=d||{};"PRE"===a.tagName?this.a=a:(this.a=document.createElement("pre"),a.appendChild(this.a));var b=d.className||"";this.a.className="mdedit"+(b?" "+b:"");this.a.setAttribute("contenteditable",!0);this.c=new p(a);this.h=new k(this);l.bind(a,"cut",this.C.bind(this));l.bind(a,"paste",this.I.bind(this));l.bind(a,"keyup",this.H.bind(this));l.bind(a,"input",this.i.bind(this));l.bind(a,"keydown",
this.F.bind(this));l.bind(a,"keypress",this.G.bind(this));this.w=d.change||function(){};this.i()}var u=function(){function a(a,d){e[a]=c[a]=b[a]=d}function d(a,c){e[a]=b[a]=c}var b={comment:m.languages.markup.comment},c={},e={},f={markup:["markup","html","xml"],javascript:["javascript","js"]},g;for(g in m.languages)if(m.languages.hasOwnProperty(g)){var h=m.languages[g];if("function"!==typeof h){var k=f[g];d("code-block fenced "+g,{pattern:new RegExp("(^ {0,3}|\\n {0,3})(([`~])\\3\\3) *("+(k?k.join("|"):
g)+")( [^`\n]*)? *\\n(?:[\\s\\S]*?)\\n {0,3}(\\2\\3*(?= *\\n)|$)","gi"),lookbehind:!0,inside:{"code-language":{pattern:/(^([`~])\2+)((?!\2)[^\2\n])+/,lookbehind:!0},"marker code-fence start":/^([`~])\1+/,"marker code-fence end":/([`~])\1+$/,"code-inner":{pattern:/(^\n)[\s\S]*(?=\n$)/,lookbehind:!0,alias:"language-"+g,inside:h}}})}}d("code-block fenced untagged",{pattern:/(^ {0,3}|\n {0,3})(([`~])\3\3)[^`\n]*\n(?:[\s\S]*?)\n {0,3}(\2\3*(?= *\n)|$)/g,lookbehind:!0,inside:{"code-language":{pattern:/(^([`~])\2+)((?!\2)[^\2\n])+/,
lookbehind:!0},"marker code-fence start":/^([`~])\1+/,"marker code-fence end":/([`~])\1+$/,"code-inner":{pattern:/(^\n)[\s\S]*(?=\n$)/,lookbehind:!0}}});d("heading setext-heading heading-1",{pattern:/^ {0,3}[^\s].*\n {0,3}=+[ \t]*$/gm,inside:{"marker heading-setext-line":{pattern:/^( {0,3}[^\s].*\n) {0,3}=+[ \t]*$/gm,lookbehind:!0},rest:c}});d("heading setext-heading heading-2",{pattern:/^ {0,3}[^\s].*\n {0,3}-+[ \t]*$/gm,inside:{"marker heading-setext-line":{pattern:/^( {0,3}[^\s].*\n) {0,3}-+[ \t]*$/gm,
lookbehind:!0},rest:c}});f={"marker heading-hash start":/^ *#+ */,"marker heading-hash end":/ +#+ *$/,rest:c};for(g=1;6>=g;g+=1)d("heading heading-"+g,{pattern:new RegExp("^ {0,3}#{"+g+"}(?!#).*$","gm"),inside:f});g={pattern:/^\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\]/,inside:{"marker bracket start":/^\[/,"marker bracket end":/\]$/,"link-text-inner":{pattern:/[\w\W]+/,inside:c}}};var f={pattern:/\[(?:\\.|[^\]])*\]/,inside:{"marker bracket start":/^\[/,"marker bracket end":/\]$/,"link-label-inner":/[\w\W]+/}},
h={pattern:/^!\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\]/,inside:{"marker image-bang":/^!/,"marker bracket start":/^\[/,"marker bracket end":/\]$/,"image-text-inner":{pattern:/[\w\W]+/,inside:c}}},k={pattern:/^(\s*)(?!<)(?:\\.|[^\(\)\s]|\([^\(\)\s]*\))+/,lookbehind:!0},n={pattern:/^(\s*)<(?:\\.|[^<>\n])*>/,lookbehind:!0,inside:{"marker brace start":/^</,"marker brace end":/>$/,"braced-href-inner":/[\w\W]+/}},l={pattern:/('(?:\\'|[^'])+'|"(?:\\"|[^"])+")\s*$/,inside:{"marker quote start":/^['"]/,"marker quote end":/['"]$/,
"title-inner":/[\w\W]+/}},p={pattern:/\( *(?:(?!<)(?:\\.|[^\(\)\s]|\([^\(\)\s]*\))*|<(?:[^<>\n]|\\.)*>)( +('(?:[^']|\\')+'|"(?:[^"]|\\")+"))? *\)/,inside:{"marker bracket start":/^\(/,"marker bracket end":/\)$/,"link-params-inner":{pattern:/[\w\W]+/,inside:{"link-title":l,href:k,"braced-href":n}}}};d("hr",{pattern:/^[\t ]*([*\-_])([\t ]*\1){2,}([\t ]*$)/gm,inside:{"marker hr-marker":/[*\-_]/g}});d("urldef",{pattern:/^( {0,3})\[(?:\\.|[^\]])+]: *\n? *(?:(?!<)(?:\\.|[^\(\)\s]|\([^\(\)\s]*\))*|<(?:[^<>\n]|\\.)*>)( *\n? *('(?:\\'|[^'])+'|"(?:\\"|[^"])+"))?$/gm,
lookbehind:!0,inside:{"link-label":f,"marker urldef-colon":/^:/,"link-title":l,href:k,"braced-href":n}});d("blockquote",{pattern:/^[\t ]*>[\t ]?.+(?:\n(?!\n)|.)*/gm,inside:{"marker quote-marker":/^[\t ]*>[\t ]?/gm,"blockquote-content":{pattern:/[^>]+/,rest:e}}});d("list",{pattern:/^[\t ]*([*+\-]|\d+\.)[\t ].+(?:\n(?!\n)|.)*/gm,inside:{li:{pattern:/^[\t ]*([*+\-]|\d+\.)[\t ].+(?:\n|[ \t]+[^*+\- \t].*\n)*/gm,inside:{"marker list-item":/^[ \t]*([*+\-]|\d+\.)[ \t]/m,rest:e}}}});d("code-block indented",
{pattern:/(^|(?:^|(?:^|\n)(?![ \t]*([*+\-]|\d+\.)[ \t]).*\n)\s*?\n)((?: {4}|\t).*(?:\n|$))+/g,lookbehind:!0});d("p",{pattern:/[^\n](?:\n(?!\n)|.)*[^\n]/g,inside:c});a("image",{pattern:/(^|[^\\])!\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\]\(\s*(?:(?!<)(?:\\.|[^\(\)\s]|\([^\(\)\s]*\))*|<(?:[^<>\n]|\\.)*>)(\s+('(?:[^']|\\')+'|"(?:[^"]|\\")+"))?\s*\)/,lookbehind:!0,inside:{"link-text":h,"link-params":p}});a("link",{pattern:/(^|[^\\])\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\]\(\s*(?:(?!<)(?:\\.|[^\(\)\s]|\([^\(\)\s]*\))*|<(?:[^<>\n]|\\.)*>)(\s+('(?:[^']|\\')+'|"(?:[^"]|\\")+"))?\s*\)/,
lookbehind:!0,inside:{"link-text":g,"link-params":p}});a("image image-ref",{pattern:/(^|[^\\])!\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\] ?\[(?:\\.|[^\]])*\]/,lookbehind:!0,inside:{"link-text":h,"link-label":f}});a("link link-ref",{pattern:/(^|[^\\])\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\] ?\[(?:\\.|[^\]])*\]/,lookbehind:!0,inside:{"link-text":g,"link-label":f}});a("image image-ref shortcut-ref",{pattern:/(^|[^\\])!\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\]/,lookbehind:!0,inside:{"marker image-bang":/^!/,"link-text":g}});
a("link link-ref shortcut-ref",{pattern:/(^|[^\\])\[(?:\\.|[^\[\]]|\[[^\[\]]*\])*\]/,lookbehind:!0,inside:{"link-text":g}});a("code",{pattern:/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/g,lookbehind:!0,inside:{"marker code-marker start":/^`/,"marker code-marker end":/`$/,"code-inner":/[\w\W]+/}});a("strong",{pattern:/(^|[^\\*_]|\\[*_])([_\*])\2(?:\n(?!\n)|.)+?\2{2}(?!\2)/g,lookbehind:!0,inside:{"marker strong-marker start":/^(\*\*|__)/,"marker strong-marker end":/(\*\*|__)$/,"strong-inner":{pattern:/[\w\W]+/,
inside:c}}});a("em",{pattern:/(^|[^\\*_]|\\[*_])(\*|_)(?:\n(?!\n)|.)+?\2(?!\2)/g,lookbehind:!0,inside:{"marker em-marker start":/^(\*|_)/,"marker em-marker end":/(\*|_)$/,"em-inner":{pattern:/[\w\W]+/,inside:c}}});a("strike",{pattern:/(^|\n|(?!\\)\W)(~~)(?=\S)([^\r]*?\S)\2/gm,lookbehind:!0,inside:{"marker strike-marker start":/^~~/,"marker strike-marker end":/~~$/,"strike-inner":{pattern:/[\w\W]+/,inside:c}}});a("comment",m.languages.markup.comment);g=m.languages.markup.tag;a("tag",{pattern:new RegExp("(^|[^\\\\])"+
g.pattern.source,"i"),lookbehind:!0,inside:g.inside});a("entity",m.languages.markup.entity);return b}(),l={bind:function(a,d,b){a.addEventListener(d,b,!1)}},v={newline:function(a){var d=a.start,b=a.d.lastIndexOf("\n")+1,c=a.d.slice(b),e=c.match(/^\s*/)[0],f=e,g=!1;/^ {0,3}$/.test(e)&&(e=c.slice(e.length),/^[*+\-]\s+/.test(e)?(f+=e.match(/^[*+\-]\s+/)[0],g=/^[*+\-]\s+$/.test(e)):/^\d+\.\s+/.test(e)?(f+=e.match(/^\d+\.\s+/)[0].replace(/^\d+/,function(a){return+a+1}),g=/^\d+\.\s+$/.test(e)):/^>/.test(e)&&
(f+=e.match(/^>\s*/)[0],g=/^>\s*$/.test(e)));f="\n"+f;e=a.e;a.e="";g&&(e=c+e,a.d=a.d.slice(0,b),a.start-=c.length,f="\n");a.d+=f;a.start+=f.length;a.end=a.start;return{add:f,b:e,start:d}},indent:function(a,d){var b=a.d.lastIndexOf("\n")+1;if(d.inverse)/\s/.test(a.d.charAt(b))&&(a.d=r(a.d,b,1),--a.start),a.e=a.e.replace(/\r?\n(?!\r?\n)\s/,"\n");else if(a.e||d.B)a.d=r(a.d,b,0,"\t"),a.e=a.e.replace(/\r?\n/,"\n\t"),a.start+=1;else return a.d+="\t",a.start+=1,a.end+=1,{add:"\t",b:"",start:a.start-1};a.end=
a.start+a.e.length;return{action:"indent",start:a.start,end:a.end,inverse:d.inverse}}};p.prototype.j=function(){var a=getSelection();if(!a.rangeCount)return 0;var d=a.getRangeAt(0),b=a=d.startContainer,d=d.startOffset;if(!(this.g.compareDocumentPosition(a)&16))return 0;do{for(;a=a.previousSibling;)a.textContent&&(d+=a.textContent.length);a=b=b.parentNode}while(a&&a!==this.g);return d};p.prototype.k=function(){var a=getSelection();return a.rangeCount?this.j()+String(a.getRangeAt(0)).length:0};p.prototype.n=
function(a,d,b){var c=document.createRange(),e=t(this.g,a),f=e;if(d&&d!==a)f=t(this.g,d);else if(!1!==b){a=f.element;var g=f.offset;d=a.textContent;b=a.parentNode;var h=d.slice(0,g);a.textContent=d.slice(g);g=document.createTextNode(h);b.insertBefore(n,a);b.insertBefore(g,n);var h=n.offsetTop,k=n.offsetHeight,l=this.g.offsetHeight,m=this.g.scrollTop;a.textContent=d;b.removeChild(n);b.removeChild(g);0>h-m?this.g.scrollTop=h:h-m+k>l&&(this.g.scrollTop=h+k-l)}c.setStart(e.element,e.offset);c.setEnd(f.element,
f.offset);e=getSelection();e.removeAllRanges();e.addRange(c)};var n=document.createElement("span");n.style.position="absolute";n.innerHTML="|";k.prototype.action=function(a){this.f.length&&this.v(this.f[this.f.length-1],a)?this.f.push(this.A(this.f.pop(),a)):this.f.push(a);this.m=[]};k.prototype.v=function(a,d){return!a.action&&!d.action&&!Array.isArray(a)&&!Array.isArray(d)&&!(a.b&&d.add)&&!(a.add&&d.b)&&!(a.add&&!d.add)&&!(!a.add&&d.add)&&!(a.add&&a.b)&&!(d.add&&d.b)&&a.start+a.add.length===d.start+
d.b.length};k.prototype.A=function(a,d){return{add:a.add+d.add,b:d.b+a.b,start:Math.min(a.start,d.start)}};k.prototype.K=function(){if(this.f.length){var a=this.f.pop();this.m.push(a);this.u(a)}};k.prototype.q=function(){if(this.m.length){var a=this.m.pop();this.f.push(a);this.apply(a)}};k.prototype.apply=function d(b){Array.isArray(b)?b.forEach(d.bind(this)):b.action?this.l.action(b.action,{inverse:b.inverse,start:b.start,end:b.end,p:!0}):this.l.apply(b)};k.prototype.u=function b(c){Array.isArray(c)?
c.forEach(b.bind(this)):c.action?this.l.action(c.action,{inverse:!c.inverse,start:c.start,end:c.end,p:!0}):this.l.apply({start:c.start,end:c.end,b:c.add,add:c.b})};h.prototype.D=function(){var b=this.a.textContent;this.s!==b&&(this.w(b),this.s=b)};h.prototype.setValue=function(b){this.a.textContent=b;this.i()};h.prototype.getValue=function(){return this.a.textContent};h.prototype.H=function(b){b=b&&b.keyCode||0;-1<[9,91,93,16,17,18,20,13,112,113,114,115,116,117,118,119,120,121,122,123,27].indexOf(b)||
-1===[33,34,35,36,37,39,38,40].indexOf(b)&&this.i()};h.prototype.i=function(){var b=this.a.textContent,c=this.c.j(),e=this.c.k();this.r();this.a.innerHTML=m.highlight(b,u);/\n$/.test(b)||(this.a.innerHTML=this.a.innerHTML+"\n");this.J();null===c&&null===e||this.c.n(c,e);this.D()};h.prototype.r=function(){void 0===this.o&&(this.o=this.a.scrollTop);setTimeout(function(){this.o=void 0}.bind(this),500)};h.prototype.J=function(){this.a.scrollTop=this.o;this.o=void 0};h.prototype.G=function(b){if(!b.metaKey&&
!b.ctrlKey&&(b=b.charCode)){var c=this.c.j(),e=this.c.k();this.h.action({add:String.fromCharCode(b),b:c===e?"":this.a.textContent.slice(c,e),start:c})}};h.prototype.F=function(b){var c=b.metaKey||b.ctrlKey;switch(b.keyCode){case 8:case 46:var c=this.c.j(),e=this.c.k(),f=c===e?1:Math.abs(e-c),c=8===b.keyCode?e-f:c;this.h.action({add:"",b:this.a.textContent.slice(c,c+f),start:c});break;case 9:c||(this.action("indent",{inverse:b.shiftKey}),b.preventDefault());break;case 219:case 221:c&&!b.shiftKey&&
(this.action("indent",{inverse:219===b.keyCode,B:!0}),b.preventDefault());break;case 13:this.action("newline");b.preventDefault();break;case 89:c&&(this.h.q(),b.preventDefault());break;case 90:c&&(b.shiftKey?this.h.q():this.h.K(),b.preventDefault())}};h.prototype.apply=function(b){var c=this.a;c.textContent=r(c.textContent,b.start,b.b.length,b.add);this.c.n(b.start,b.start+b.add.length);this.i()};h.prototype.action=function(b,c){c=c||{};var e=this.a.textContent,f=c.start||this.c.j(),g=c.end||this.c.k(),
e={start:f,end:g,d:e.slice(0,f),t:e.slice(g),e:e.slice(f,g)},f=v[b](e,c);this.r();this.a.textContent=e.d+e.e+e.t;f&&!c.p&&this.h.action(f);this.c.n(e.start,e.end,!1);this.i()};h.prototype.C=function(){var b=this.c.j(),c=this.c.k();b!==c&&this.h.action({add:"",b:this.a.textContent.slice(b,c),start:b})};h.prototype.I=function(b){var c=this.c.j(),e=this.c.k(),e=c===e?"":this.a.textContent.slice(c,e);b.clipboardData&&(b.preventDefault(),b=b.clipboardData.getData("text/plain"),this.apply({add:b,b:e,start:c}),
this.h.action({add:b,b:e,start:c}),c+=b.length,this.c.n(c,c),this.i())};return h}"function"===typeof define&&define.amd?define(["prismjs"],q):"object"===typeof exports?module.exports=q(require("prismjs")):this.mdEdit=q(this.Prism);})();
